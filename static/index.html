<html>
<link rel="stylesheet" type="text/css" href="static/style.css">
<script src="static/jquery-1.12.1.min.js"></script>
<script>
$( document ).ready(function() {
    var canvas = document.getElementById("canvas");
	var jCanvas = $("#canvas");
	var context = canvas.getContext("2d");
	
	var bw = jCanvas.width()-25;
	var bh = jCanvas.height()-40;
	var halfBh = bh/2;
	var size = 10;
	var leftMargin = 4;
	var topMargin = 4;
	
	var letters = ['a','b','c','d','e','f','g','h','i','j'];
	
	var enemyField = [];
	var friendlyField = [];
	
	function drawBoard(){
		context.strokeStyle = "gray";
		
		context.stroke();
		
		//draw grid
		
		var countX = bw/size;
		var countY = bh/(size*2);
		for (var x = 0; x <= bw; x += countX) {
			context.moveTo(leftMargin + x + size, size + topMargin);
			context.lineTo(leftMargin + x + size, halfBh + size + topMargin);
			
			context.moveTo(leftMargin + x + size, size + halfBh + size + topMargin*2);
			context.lineTo(leftMargin + x + size, halfBh + size + halfBh + size + topMargin*2);
		}


		for (var y = 0; y <= halfBh; y += countY) {
			context.moveTo(leftMargin + size, 0.5 + y + size + topMargin);
			context.lineTo(leftMargin + bw + size, 0.5 + y + size + topMargin);
			
			context.moveTo(leftMargin + size, 0.5 + y + size + halfBh + size + topMargin*2);
			context.lineTo(leftMargin + bw + size, 0.5 + y + size + halfBh + size + topMargin*2);
		}
		
		
		context.strokeStyle = "black";
		context.stroke();
		
		//draw numbers/letters
		
		for(var i = 1; i <= size; ++i)
		{
			context.fillText(i,0.5,0.5+i*countY);
			context.fillText(i,0.5,0.5+(i+size)*countY + topMargin);
			
			
			context.fillText(letters[i-1], 0.5+i*countY, 10);
			context.fillText(letters[i-1], 0.5+i*countY, 25 + size*countY);
		}
		
		
		//fill field arrays
		
		for(var col = 1; col <= size; ++col)
		{
			enemyField[col-1] = [];
			friendlyField[col-1] = []
			for(var row = 1; row <= size; ++row)
			{
				var enemySquare = {};
				enemySquare.left = leftMargin + (col-1)*countX + size;
				enemySquare.right = leftMargin + col*countX + size;
				enemySquare.top = 0.5 + (row-1)*countY + size + topMargin;
				enemySquare.bottom = 0.5 + row*countY + size + topMargin;
				enemySquare.fillStyle = "white";
				enemyField[col-1][row-1] = enemySquare;
				
				
				var friendlySquare = {};
				friendlySquare.left = leftMargin + (col-1)*countX + size;
				friendlySquare.right = leftMargin + col*countX + size;
				friendlySquare.top = 0.5 + (row-1)*countY + size*2 + topMargin*2 + halfBh ;
				friendlySquare.bottom = 0.5 + row*countY + size*2 + topMargin*2 + halfBh;
				friendlySquare.fillStyle = "white";
				friendlyField[col-1][row-1] = friendlySquare;
				
			}
		}
	}
	
	function fillSquares(){
		for(var col = 1; col <= size; ++col)
		{
			for(var row = 1; row <= size; ++row)
			{
				var enemySquare = enemyField[col-1][row-1];
				
				fillSquare(enemySquare);
				
				
				var friendlySquare = friendlyField[col-1][row-1];
				fillSquare(friendlySquare);
			}
			
		}
	}
	
	
	function fillSquare(square){
		context.beginPath();
		context.rect(square.left+4, square.top+4, (bw/size)-8, (bh/(size*2))-8);
		context.fillStyle = square.fillStyle;
		context.fill();
	}
	
	
	canvas.onmousemove = function(e){
		var rect = this.getBoundingClientRect();
		var x = e.clientX-rect.left;
		var y = e.clientY-rect.top;
		for(var col = 1; col <= size; ++col)
		{
			for(var row = 1; row <= size; ++row)
			{
				var square = enemyField[col-1][row-1];
				
				context.beginPath();
				context.rect(square.left, square.top, bw/size, bh/(size*2));
				
				if(context.isPointInPath(x,y))
					square.fillStyle = "red";
				else
					square.fillStyle = "white"
					
					
				var square = friendlyField[col-1][row-1];
				
				context.beginPath();
				context.rect(square.left, square.top, bw/size, bh/(size*2));
				
				if(context.isPointInPath(x,y))
					square.fillStyle = "red";
				else
					square.fillStyle = "white"
			}
		}
		fillSquares();
	
	}
	
	var webSocket;
	var url = "ws://{{$}}/game";
	var jSessionState = $("#sessionState");
	
	
	function connect(){
		webSocket = new WebSocket(url);
		jSessionState.append("<p>Connecting...</p>");
		webSocket.onopen = function(event){
			jSessionState.append("<p>Connected</p>");
		}
	}
	
	drawBoard();
	connect();
	
});
</script>



<body>
	<table>
	<tr>
	<td><canvas id="canvas" width="430px" height="840px"></canvas></td>
	<td><div id=sessionState></div></td>
	</tr>
	</table>
	
</body>


</html>